# 3D 音频 HRTF 控制器

把你的普通音频变成沉浸式 3D 空间音频！这个应用使用 HRTF（头部相关传输函数）技术，让声音听起来像是从你周围的不同方向传来。非常适合 ASMR、音乐、游戏，或者只是让你的音频体验更酷。

## 为什么制作这个应用

故事是这样的：我在听有声读物时总是犯困。当时正好在研究空间音频，所以我想——为什么不自己做一个 3D 音频效果呢？因为它模拟的是你耳朵实际听到声音的方式，所以用耳机效果最好。

然后我试了试 YouTube 上的 ASMR 视频...哇，效果太棒了。让一切都变得更加沉浸和刺激。对于某些视频，效果真的很神奇。你得自己试试！

## 它能做什么

- **实时处理**：抓取你的系统音频并实时处理，几乎没有延迟
- **3D 定位**：使用 HRTF 让声音感觉像是从特定方向传来
- **简单控制**：用滑块让声音在水平和垂直方向上移动
- **自动旋转**：自动旋转音频位置——你可以调整旋转速度
- **跨平台**：支持 Windows 和 macOS
- **开箱即用**：捕获系统正在播放的任何音频

## 你需要什么

- **你的电脑**：Windows 10/11 或 macOS 10.14+
- **虚拟音频驱动**：
  - Windows 用户：VB-CABLE
  - Mac 用户：BlackHole 2ch
- **耳机**：说真的，用耳机。效果会好很多。

## 开始使用

### 第一步：安装虚拟音频驱动

你需要这个，这样应用才能"听到"系统正在播放的内容。

#### macOS
1. 从 https://existential.audio/blackhole/download/ 下载 BlackHole 2ch
2. 安装它（跟着安装程序走就行）
3. 打开系统偏好设置 > 声音，将 BlackHole 2ch 设置为输出设备

#### Windows
1. 从 https://download.vb-audio.com/Download_CABLE/VBCABLE_Driver_Pack45.zip 下载 VB-CABLE
2. 运行 `VBCABLE_Setup_x64.exe` 并安装
3. 在声音设置中，将 'CABLE Input' 设置为默认播放设备

### 第二步：运行应用

下载适合你平台的最新版本，双击运行——无需安装！

## 怎么用

### 快速开始

1. **启动应用** - 打开 3D 音频 HRTF 控制器
2. **检查状态** - 应该显示"Virtual Audio: OK"（如果没有，检查一下驱动安装）
3. **播放点什么** - 在电脑上播放任何音频（音乐、视频、游戏，什么都行）
4. **移动它** - 使用滑块来定位声音：
   - **方位角**：左右/周围（0° = 前方，90° = 右侧，180° = 后方，270° = 左侧）
   - **仰角**：上下（-40° = 下方，0° = 水平，90° = 上方）

### 控制说明

- **方位角滑块**：让声音源围绕你旋转（0-360°）
- **仰角滑块**：上下移动（-40° 到 90°）
- **自动旋转复选框**：开启自动旋转
- **速度控制**：旋转多快（每秒 1-180°）
- **重置按钮**：回到中心位置并停止自动旋转
- **输出设备下拉框**：选择你想让声音从哪里出来

### 使用技巧

- **戴上耳机**：3D 效果用耳机会更明显
- **先试试自动旋转**：打开它，感受声音在你周围移动
- **调整速度**：不同速度感觉不同——找到你喜欢的
- **发挥创意**：手动定位声音来匹配你正在看/听的内容

## 工作原理（技术部分）

### 整体流程

系统播放音频 → 虚拟音频设备捕获 → 应用用 HRTF 处理 → 你听到 3D 音频。就这么简单！

### 技术细节

#### 音频捕获
应用通过虚拟音频设备（Windows 上是 VB-CABLE，Mac 上是 BlackHole）监听系统音频。它以 48 kHz、立体声、512 采样的小块来捕获，实现低延迟。

#### HRTF 处理

**HRTF** 是头部相关传输函数的缩写。名字很专业，但其实就是模拟你的头部和耳朵如何改变来自不同方向的声音。它考虑了：
- **时间差**：声音到达你双耳的时间略有不同
- **音量差**：你的头部会阻挡一些声音，所以一只耳朵听到的更大声
- **频率滤波**：你的头部和耳朵形状会改变不同频率的声音

**应用做了什么**：
1. **找到合适的 HRTF**：根据你定位的声音位置（方位角/仰角），从数据库中选择最匹配的 HRTF
2. **定位它**：对左右声道应用 ±30° 偏移来创建立体声分离
3. **处理它**：将音频与每个耳朵的 HRTF 数据进行卷积（就是"滤波"的另一种说法）
4. **保持平滑**：使用重叠缓冲区，这样就不会有咔嗒声或爆音
5. **调整音量**：应用 0.3 的增益来防止削波

#### 音频输出
将处理后的音频发送到你选择的输出设备，32 位浮点格式，实时播放。

### 处理流程

```
你的系统音频
    ↓
虚拟音频设备（捕获它）
    ↓
应用处理（HRTF 魔法在这里发生）
    ↓
你的耳机/扬声器
    ↓
你的耳朵（享受 3D 音频！）
```

### 关于 HRTF 数据

应用使用来自 KEMAR（用于声学研究的假人头）的预计算 HRTF 数据，这是音频领域的标准数据集。这些数据帮助模拟声音如何根据方向变化。

### 位置控制

- **方位角（0-360°）**：声音在你周围的哪个位置
  - 0° = 正前方
  - 90° = 右侧
  - 180° = 后方
  - 270° = 左侧

- **仰角（-40° 到 90°）**：高低位置
  - -40° = 下方
  - 0° = 耳朵高度
  - 90° = 正上方

### 自动旋转

自动旋转功能会平滑地让声音围绕你旋转。你可以控制：
- **多快**：每秒 1-180 度
- 它使用系统时钟来保持旋转平滑
- 在单独线程中运行，所以不会卡住应用

## 技术规格（给好奇的人）

- **音频格式**：32 位浮点，48 kHz
- **处理**：实时卷积与重叠相加
- **延迟**：约 10-20ms（取决于块大小）
- **HRTF 数据**：KEMAR 测量数据
- **GUI**：PySide6 (Qt6)
- **音频 I/O**：sounddevice (PortAudio)

## 当前限制

- 只支持 Windows 和 macOS（抱歉 Linux 用户，也许以后会支持！）
- 需要安装那个虚拟音频驱动
- 建议用耳机（扬声器也能用，但耳机效果更好）
- 增益固定在 0.3（现在还改不了）
- HRTF 基于平均头部测量（可能对每个人不是最完美的）

## 未来计划

未来版本的想法：
- 可调节的增益控制
- 预设位置（比如"前方"、"后方"、"上方"）
- 视觉反馈（看到声音定位在哪里）
- 更多 HRTF 数据集可选
- Linux 支持
- 录制/导出处理后的音频

## 许可证

[在此添加你的许可证信息]

## 贡献

[如果想的话，添加贡献指南]

## 致谢

- HRTF 数据来自 KEMAR 测量
- 虚拟音频驱动：BlackHole (macOS) 和 VB-CABLE (Windows)
- 库：NumPy、sounddevice
